{% extends "base.html" %}
{% load static %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;400&display=swap" rel="stylesheet">
<style>
    body, .profile-full-bg {
        background: #181818 !important;
    }
    .profile-full {
        max-width: 600px;
        margin: 0 auto;
        padding: 3rem 1rem 2rem 1rem;
        font-family: 'Montserrat', sans-serif;
        color: #fff;
    }
    .profile-img-wrapper {
        position: relative;
        width: 140px;
        height: 140px;
        margin: 0 auto 1.2rem auto;
    }
    .profile-img-wrapper img {
        width: 140px;
        height: 140px;
        object-fit: cover;
        border-radius: 50%;
        border: 5px solid #ff6600;
        background: #222;
    }
    .profile-img-wrapper label {
        position: absolute;
        bottom: 0;
        right: 0;
        background: #fff;
        border-radius: 50%;
        border: 1.5px solid #ff6600;
        padding: 8px 9px 7px 9px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .profile-img-wrapper label i {
        color: #ff6600;
        font-size: 1.2rem;
    }
    .profile-title {
        font-size: 2.1rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 0.2rem;
        color: #fff;
        letter-spacing: 1px;
    }
    .profile-joined {
        font-size: 1.05rem;
        color: #bbb;
        text-align: center;
        margin-bottom: 1.5rem;
    }
    .profile-form label {
        color: #bbb;
        font-size: 1.05rem;
        margin-bottom: 0.2rem;
    }
    .profile-form input {
        font-size: 1.08rem;
        border-radius: 8px;
        margin-bottom: 1.2rem;
        background: #222;
        color: #fff;
        border: 1.5px solid #444;
    }
    .profile-form input:focus {
        border-color: #ff6600;
        background: #181818;
        color: #fff;
    }
    .profile-btn {
        width: 100%;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1.13rem;
        margin-bottom: 0.9rem;
        transition: background 0.2s;
        padding: 0.7rem 0;
    }
    .profile-btn-primary {
        background: #ff6600;
        color: #fff;
        border: none;
    }
    .profile-btn-primary:hover {
        background: #e65c00;
    }
    .profile-btn-outline {
        background: #181818;
        color: #ff6600;
        border: 2px solid #ff6600;
    }
    .profile-btn-outline:hover {
        background: #ff6600;
        color: #fff;
    }
    .profile-btn-danger {
        background: #181818;
        color: #d9534f;
        border: 2px solid #d9534f;
    }
    .profile-btn-danger:hover {
        background: #d9534f;
        color: #fff;
    }
    .profile-progress {
        height: 20px;
        border-radius: 8px;
        font-size: 1.05rem;
        font-weight: 500;
        background: #222;
    }
    .profile-progress .progress-bar {
        background: linear-gradient(90deg, #ff6600 60%, #ffb366 100%);
        color: #222;
        font-weight: 600;
    }
    @media (max-width: 600px) {
        .profile-full { padding: 2rem 0.2rem 1.5rem 0.2rem; }
        .profile-title { font-size: 1.3rem; }
        .profile-img-wrapper { width: 100px; height: 100px; }
        .profile-img-wrapper img { width: 100px; height: 100px; }
        .profile-btn {
            font-size: 1.05rem !important;
            padding: 1rem 0 !important;
            min-height: 48px !important;
        }
        .profile-form input {
            font-size: 1rem !important;
            padding: 0.7rem 0.8rem !important;
        }
        .profile-progress {
            font-size: 0.95rem !important;
            height: 18px !important;
        }
        .profile-img-wrapper label {
            padding: 6px 7px 6px 7px !important;
        }
    }
</style>
<div class="profile-full-bg">
    <div class="profile-full">
        <div class="profile-img-wrapper">
            {% if profile.profile_image %}
                <img src="{{ profile.profile_image.url }}" alt="" loading="lazy">
            {% else %}
                <img src="{% static 'images/default_profile.png' %}" alt="" loading="lazy">
            {% endif %}
            <form method="post" enctype="multipart/form-data" style="margin:0; padding:0;">
                {% csrf_token %}
                <label for="profile_image" title="Change profile image"><i class="fa fa-camera"></i>
                    <input type="file" name="profile_image" id="profile_image" class="d-none" onchange="this.form.submit()">
                </label>
            </form>
        </div>
        <div class="profile-title">{{ user.username }}</div>
        <div class="profile-joined">Joined: {{ user.date_joined|date:'M d, Y' }}</div>
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success" id="profile-success-message">{{ message }}</div>
            {% endfor %}
        {% endif %}
        <script>
            setTimeout(function() {
                var msg = document.getElementById('profile-success-message');
                if (msg) { msg.style.display = 'none'; }
            }, 2000);
        </script>
        <form method="post" class="profile-form mb-2">
            {% csrf_token %}
            <label><i class="fa fa-envelope"></i> Email</label>
            <input type="email" name="email" class="form-control" value="{{ user.email }}" required>
            <label><i class="fa fa-phone"></i> Phone</label>
            <input type="text" name="phone" class="form-control" value="{{ profile.phone }}" required>
            <button type="submit" class="profile-btn profile-btn-primary">Update Profile</button>
        </form>
        <button class="profile-btn profile-btn-outline" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
            <i class="fa fa-key"></i> Change Password
        </button>
        <button class="profile-btn profile-btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
            <i class="fa fa-trash"></i> Delete Account
        </button>
        <div class="mt-3 mb-1">
            <label class="form-label">Profile Completion</label>
            <div class="progress profile-progress">
                {% with percent=0 %}
                    {% if user.email %}{% widthratio 1 1 33 as percent %}{% endif %}
                    {% if profile.phone %}{% widthratio percent 1 33 as percent %}{% endif %}
                    {% if profile.profile_image %}{% widthratio percent 1 34 as percent %}{% endif %}
                    {% if percent > 100 %}{% widthratio 100 1 1 as percent %}{% endif %}
                    <div class="progress-bar" role="progressbar" style="width: {{ percent|floatformat:0 }}%;">{{ percent|floatformat:0 }}%</div>
                {% endwith %}
            </div>
        </div>
    </div>
</div>
<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'password_change' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="old_password" class="form-label">Old Password</label>
            <input type="password" class="form-control" name="old_password" required>
          </div>
          <div class="mb-3">
            <label for="new_password1" class="form-label">New Password</label>
            <input type="password" class="form-control" name="new_password1" required>
          </div>
          <div class="mb-3">
            <label for="new_password2" class="form-label">Confirm New Password</label>
            <input type="password" class="form-control" name="new_password2" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Change Password</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Delete Account Modal -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'delete_account' %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="deleteAccountModalLabel">Delete Account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete your account? This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} 